name: Check PR Merge

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  check_merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Check PR Checklist
        id: checklist
        run: |
          # Fetch the pull request details using the GitHub API and store the response in a file
          curl -s -H "Authorization: Bearer ${{ secrets.TOKEN }}" \
          "https://api.github.com/repos/${{ github.repository }}/pulls/${{ github.event.pull_request.number }}" \
          | jq -r '.body' > pr_description.txt

          # Extract all checkboxes ([ ]) from the description using grep
          unchecked_checkboxes=$(grep -o '\[[ x]\]' pr_description.txt | grep '\[ \]')

          # If there are unchecked checkboxes, fail the workflow with an error message
          if [ -n "$unchecked_checkboxes" ]; then
            echo "Please make sure all checkboxes are checked before merging."
            exit 1
          fi

      - name: Cleanup
        run: |
          # Cleanup temporary files
          rm pr_description.txt
